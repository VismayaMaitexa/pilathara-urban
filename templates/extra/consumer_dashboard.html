{% load widget_tweaks %}
{% load static %}

<!doctype html>
<html class="no-js" lang="en">

    <head>
        <!-- meta data -->
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

        <!--font-family-->
		<link href="https://fonts.googleapis.com/css?family=Poppins:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
        
        <!-- title of site -->
        <title>Directory Landing Page</title>

        <!-- For favicon png -->
		<link rel="shortcut icon" type="image/icon" href="static/logo/favicon.png"/>
       
        <!--font-awesome.min.css-->
        <link rel="stylesheet" href="static/assets/css/font-awesome.min.css">

        <!--linear icon css-->
		<link rel="stylesheet" href="static/assets/css/linearicons.css">

		<!--animate.css-->
        <link rel="stylesheet" href="static/assets/css/animate.css">

		<!--flaticon.css-->
        <link rel="stylesheet" href="static/assets/css/flaticon.css">

		<!--slick.css-->
        <link rel="stylesheet" href="static/assets/css/slick.css">
		<link rel="stylesheet" href="static/assets/css/slick-theme.css">
		
        <!--bootstrap.min.css-->
        <link rel="stylesheet" href="static/assets/css/bootstrap.min.css">
		
		<!-- bootsnav -->
		<link rel="stylesheet" href="static/assets/css/bootsnav.css" >	
        
        <!--style.css-->
        <link rel="stylesheet" href="static/assets/css/style1.css">
        
        <!--responsive.css-->
        <link rel="stylesheet" href="static/assets/css/responsive.css">
        
        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		
        <!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
			<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->

    </head>
	<style>
        .cart-popup {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #28a745; /* Green for success */
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 14px;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none;
        }
    
        .cart-popup.error {
            background-color: #dc3545; /* Red for error */
        }
    
        .cart-popup.fade-out {
            animation: fadeOut 1s forwards;
        }
    
        @keyframes fadeOut {
            to {
                opacity: 0;
                visibility: hidden;
            }
        }
    </style>
    
    
	<body>
		
		<!--welcome-hero start -->
		<!-- <section id="home" class="welcome-hero">
			<div class="container">
				
				<div class="welcome-hero-serch-box">
					<div class="welcome-hero-form">
						<div class="single-welcome-hero-form">
							<h3>what?</h3>
							<form action="index.html">
								<input type="text" placeholder="Ex: palce, resturent, food, automobile" />
							</form>
							
						</div>
						
					</div>
					<div class="welcome-hero-serch">
						<button class="welcome-hero-btn" onclick="window.location.href='#'">
							 search  <i data-feather="search"></i> 
						</button>
					</div>
                    <div class="search">
                        <form action="{% url 'search' %}" method="GET">
                            <input type="text" name="query" placeholder="Search">
                            <button type="submit"><i class="fa fa-search"></i> Search</button>
                        </form>
                    </div>
                    
				</div>
			</div>

		</section>/.welcome-hero -->
		<!--welcome-hero end -->

		<!--list-topics start -->
        
		<section id="list-topics" class="list-topics">
            <div class="container">
                <div class="list-topics-content">
                    <ul>
                        <!-- Cart Section -->
                        
                        
                        <!-- Bookings Section -->
                        <li>
                            <div class="single-list-topics-content">
                                <div class="single-list-topics-icon">
                                    <i class="flaticon-travel"></i>
                                </div>
                                <h2><a href="{% url 'my-bookings' %}">Bookings</a></h2>
                                <p>214 listings</p>
                            </div>
                        </li>
                        
                        <!-- Payment Section -->
                        <li>
                            <div class="single-list-topics-content">
                                <div class="single-list-topics-icon">
                                    <i class="flaticon-building"></i>
                                </div>
                                <h2><a href="{% url 'singlepayment' %}">Payment</a></h2>
                                <p>185 listings</p>
                            </div>
                        </li>
                        <li>
                            <div class="single-list-topics-content">
                                <div class="single-list-topics-icon">
                                    <i class="fa fa-cart-plus"></i>
                                </div>
                                <h2>
                                    <a href="{% url 'cart' %}">
                                        Cart
                                        {% if service_count_in_cart > 0 %}
                                            <span>({{ service_count_in_cart }})</span>
                                        {% else %}
                                            <span>(0)</span>
                                        {% endif %}
                                    </a>
                                </h2>
                                <p>150 listings</p>
                            </div>
                        </li>
                        
                        <!-- Logout Section -->
                        <li>
                            <div class="single-list-topics-content">
                                <div class="single-list-topics-icon">
                                    <i class="flaticon-pills"></i>
                                </div>
                                <h2><a href="{% url 'home' %}">Logout</a></h2>
                                <p>200 listings</p>
                            </div>
                        </li>
                    </ul>
                </div>
            </div><!--/.container-->
        </section>
        <section id="explore" class="explore">
            <div class="container">
                <div class="section-header">
                    <h2>Explore Services</h2>
                </div><!--/.section-header-->
                <div class="explore-content">
                    <div class="row">
                        {% for service in services %}
                        <div class="col-md-4 col-sm-6">
                            <div class="single-explore-item">
                                <div class="single-explore-img">
                                    <a href="{% url 'add-to-cart' service.id %}">
                                        <img src="{% static service.service_pic.url %}" alt="{{ service.worker.user.username }}'s profile pic">
                                    </a>
                                    <div class="single-explore-img-info">
                                        <!-- <button onclick="window.location.href='{% url 'add-to-cart' service.id %}'">Add to Cart</button> -->
                                        <!-- <button class="add-to-cart-btn" data-service-id="{{ service.id }}">Add to Cart</button>
                                         <div id="cart-message" style="display:none; color: green;"></div> -->
                                         <div>
<!-- Add to Cart Button -->
                                           <button class="add-to-cart-btn" data-service-id="{{ service.id }}">Add to Cart</button>

<!-- Pop-up Container -->
                                           <div id="cart-popup" class="cart-popup" style="display: none;">
                                                <span id="cart-popup-message"></span>
                                           </div>
                                        </div>
                                        
                                        <div class="single-explore-image-icon-box">
                                            <ul>
                                                <li>
                                                    <div class="single-explore-image-icon">
                                                        <i class="fa fa-arrows-alt"></i>
                                                    </div>
                                                </li>
                                                <li>
                                                    <div class="single-explore-image-icon">
                                                        <i class="fa fa-bookmark-o"></i>
                                                    </div>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="single-explore-txt bg-theme-1">
                                    <h2><a href="#">{{ service.worker.user.username }}</a></h2>
                                    <p class="explore-rating-price">
                                        <span class="explore-rating">5.0</span> <!-- Example rating, replace with dynamic rating if needed -->
                                        <span class="explore-price-box">
                                            <span class="explore-price">&#8377; {{ service.service_rate }}</span>
                                        </span>
                                    </p>
                                    <div class="explore-person">
                                        <div class="row">
                                            <div class="col-sm-2">
                                                <div class="explore-person-img">
                                                    <a href="#">
                                                        <img src="static/assets/images/explore/person.png" alt="person">
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="col-sm-10">
                                                <p>{{ service.skills }}</p>
                                            </div>
                                            <div class="col-sm-10">
                                                <p>{{ service.phone }}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="explore-open-close-part">
                                        <div class="row">
                                            
                                            
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div><!--/.container-->
        </section>
        
		<script src="static/assets/js/jquery.js"></script>
        
        <!--modernizr.min.js-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
		
		<!--bootstrap.min.js-->
        <script src="static/assets/js/bootstrap.min.js"></script>
		
		<!-- bootsnav js -->
		<script src="static/assets/js/bootsnav.js"></script>

        <!--feather.min.js-->
        <script  src="static/assets/js/feather.min.js"></script>

        <!-- counter js -->
		<script src="static/assets/js/jquery.counterup.min.js"></script>
		<script src="static/assets/js/waypoints.min.js"></script>

        <!--slick.min.js-->
        <script src="static/assets/js/slick.min.js"></script>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
		     
        <!--Custom JS-->
        <script src="static/assets/js/custom.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const buttons = document.querySelectorAll(".add-to-cart-btn");
        
                buttons.forEach((button) => {
                    button.addEventListener("click", function (event) {
                        event.preventDefault(); // Prevent page redirection
        
                        const serviceId = this.getAttribute("data-service-id");
                        const popup = document.getElementById("cart-popup");
        
                        fetch(`/add-to-cart/${serviceId}/`, {
                            method: "POST",
                            headers: {
                                "X-CSRFToken": getCookie("csrftoken"),
                                "Content-Type": "application/json",
                            },
                        })
                            .then((response) => response.json())
                            .then((data) => {
                                // Display the pop-up message
                                popup.textContent = data.message;
                                popup.classList.remove("error");
                                popup.style.display = "block";
        
                                // Hide the pop-up after 3 seconds
                                setTimeout(() => {
                                    popup.classList.add("fade-out");
                                    setTimeout(() => {
                                        popup.style.display = "none";
                                        popup.classList.remove("fade-out");
                                    }, 1000);
                                }, 3000);
                            })
                            .catch((error) => {
                                console.error("Error:", error);
        
                                // Display error message in the pop-up
                                popup.textContent = "Failed to add to cart!";
                                popup.classList.add("error");
                                popup.style.display = "block";
        
                                // Hide the pop-up after 3 seconds
                                setTimeout(() => {
                                    popup.classList.add("fade-out");
                                    setTimeout(() => {
                                        popup.style.display = "none";
                                        popup.classList.remove("fade-out");
                                    }, 1000);
                                }, 3000);
                            });
                    });
                });
        
                // Helper function to get CSRF token from cookies
                function getCookie(name) {
                    let cookieValue = null;
                    if (document.cookie && document.cookie !== "") {
                        const cookies = document.cookie.split(";");
                        for (let i = 0; i < cookies.length; i++) {
                            const cookie = cookies[i].trim();
                            if (cookie.startsWith(name + "=")) {
                                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                break;
                            }
                        }
                    }
                    return cookieValue;
                }
            });
        </script>
        
    </body>
	
</html>